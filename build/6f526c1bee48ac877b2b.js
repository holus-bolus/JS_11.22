function app(){let t=document.forms[0],a=!1,s="",n=0,r=0,l="",i=[],c="",d=0,h=/[\/\*\-\+]/,o=o=>{let b=o.target||o,p=k(o.keyCode,o.shiftKey,o.altKey,o.metaKey),y=t.output;if(13===o.keyCode?e.preventDefault():p||o.keyCode||(p=b.getAttribute("data-fn")),p&&y){let e=+y.maxLength,t=10**e,o=!isNaN(p),k="."===p,b="%"===p,x="sqrt"===p,v="+-"===p,S="mrc"===p,C="m-"===p,L="m+"===p,_="/*-+".indexOf(p)>-1,q="="===p,M="C"===p;if(!s){if(i.length&&(c=i[i.length-1]),(o||k||b||x||v||_)&&(a||(a=!0,(o||k)&&(l="",i=["0"],c=i[0],d=0)),i.length||i.push("0")),o){if(isNaN(c))i.push(p);else if(c.length<e){let e=c+p;"0"===e[0]&&"."!==e[1]&&(e=e.substr(1)),i[i.length-1]=e}}else if(k)-1===c.indexOf(".")&&(isNaN(c)?i.push("0."):c.length<e-1&&(i[i.length-1]+=p));else if(b)i.length&&(isNaN(c)?(i.push(""+i[0]*(i[0]/100)),i[i.length-1]=N(i[i.length-1])):l&&i.indexOf(l)>-1?i[i.length-1]=N(i[0]*i[i.length-1]/100):(i[i.length-1]=N(i[i.length-1]/100),a=!1)),g();else if(x)i.length&&(isNaN(c)?i.push(String(Math.sqrt(i[0]))):i[i.length-1]=String(Math.sqrt(i[i.length-1]))),g();else if(v)i.length&&(isNaN(c)?i[0]=String(-i[0]):i[i.length-1]=String(-i[i.length-1]));else if(S)0!==r&&r===n?i.length<=1&&(a=!1,r=0,f(!1)):(a||(a=!0),isNaN(c)||!i.length?i.push(String(r)):i[i.length-1]=String(r),c=i[i.length-1],d=c,f(0!==r));else if(_){if(l=p,isNaN(c))i[i.length-1]=l;else{let e=i.join(" ");h.test(e)&&(i=[`${m(i[0],i[1],i[2])}`],i[0]=N(i[0]),c=i[0],n=c),i.push(l)}g()}else{let e=C||L;if(q||e){a=!1,l&&i.indexOf(l)>-1&&(d=c);let t=d&&-1===i.indexOf(l),s=!isNaN(d);t?e||(i=[`${m(n,op,d)}`]):s?i=[`${m(i[0],l,d)}`]:(d=i[0],i=[`${m(n,l,n)}`]),i[0]=N(i[0]),e&&(C&&(r-=+i[0]),L&&(r+=+i[0]),f(0!==r)),g()}}if("C"!==p){if(c=i[i.length-1],isNaN(c)&&"NaN"!==c||(n=c),Math.abs(n)===1/0||"NaN"===n)s="0";else if(n<=-t/10){let a=e-3;a<0&&(a=0),s=(n/t).toFixed(a)}else if(n>=t){let a=e-2;a<0&&(a=0),s=(n/t).toFixed(a)}let a=s||String(n);s?u():a=n>=-1e8&&n<-1e7||n>=1e8&&n<1e9?a.substr(0,e-1):a.substr(0,e),y.value=a}}M&&(a=!1,s="",n=0,(Math.abs(r)===1/0||isNaN(r))&&(r=0,f(!1)),l="",i=[],c="",d=0,y.value=n,g(),u(!1))}},g=()=>{let e=t.output;if(e){let t="calc__screen--fade-in",a=e.classList;a.remove(t),e.offsetWidth,setTimeout((()=>{a.add(t)}),0)}},u=(e=!0)=>{t.querySelector(".calc__error").textContent=e?"E":""},f=(e=!0)=>{t.querySelector(".calc__memory").textContent=e?"M":""},k=(e,t,a,s)=>{let n="";switch(e){case 12:case 27:case 67:s||(n="C");break;case 13:n="=";break;case 48:case 96:n="0";break;case 49:case 97:n="1";break;case 50:case 98:n="2";break;case 51:case 99:n="3";break;case 52:case 100:n="4";break;case 53:case 101:n=t?"%":"5";break;case 54:case 102:n="6";break;case 55:case 103:n="7";break;case 56:n=t?"*":"8";break;case 104:n="8";break;case 57:case 105:n="9";break;case 77:n="mrc";break;case 83:n="sqrt";break;case 106:n="*";break;case 107:n="+";break;case 187:n=t?"+":"=";break;case 188:n=t?"m-":"";break;case 109:case 189:n=a?"+-":"-";break;case 110:n=".";break;case 190:n=t?"m+":".";break;case 111:case 191:n="/";break;default:n=""}return n},b=(e,a="down")=>{e.target;let s=k(e.keyCode,e.shiftKey,e.altKey,e.metaKey),n=t.querySelector(`[data-fn="${s}"]`);if(n){let e="calc__btn--active",t=n.classList;"down"!==a||t.contains(e)?"up"===a&&t.contains(e)&&t.remove(e):t.add(e)}},N=(e,t=9)=>{let a=10**-t,s=Math.round(e/a)*a;return String(+s.toFixed(t))},m=(e,t,a)=>{let s=0,n=isNaN(e)?s:+e,r=isNaN(a)?n:+a;switch(t){case"/":s=n/r;break;case"*":s=n*r;break;case"-":s=n-r;break;case"+":s=n+r;break;default:s=n}return s.toFixed(8)};t.addEventListener("click",o),document.addEventListener("keydown",o),document.addEventListener("keydown",b),document.addEventListener("keyup",(e=>b(e,"up")))}document.addEventListener("DOMContentLoaded",app);